# NeuralNetworkService

**NeuralNetworkService** — это микросервис на Python, реализующий REST API для получения предсказаний от нейросетевой модели ResNet50 по изображениям блюд. Сервис предназначен для интеграции с другими компонентами системы (например, мобильным приложением или веб-интерфейсом) и предоставляет удобный способ классификации изображений еды.

## Основные возможности

- **REST API** на FastAPI для получения предсказаний по ID изображения, загруженного в MongoDB.
- Поддержка работы с изображениями через базу данных MongoDB.
- Использование предобученной модели ResNet50 с возможностью дообучения (fine-tuning).
- Гибкая конфигурация модели (размеры изображений, количество классов, пути к весам и названиям классов).
- Dockerfile для контейнеризации сервиса.
- Поддержка различных платформ (Windows с CUDA, MacOS ARM) через отдельные requirements-файлы.

## Архитектура и структура проекта

- **src/main.py** — точка входа, инициализация FastAPI-приложения, настройка CORS, подключение роутеров.
- **src/app/endpoints.py** — определение API-эндпоинтов, включая получение предсказания по ID изображения.
- **src/app/services.py** — сервисный слой, реализующий бизнес-логику взаимодействия с нейросетью и базой данных.
- [src/app/neural_network.py](./NeuralNetwork.md) — реализация класса нейросети на базе ResNet50, конфигурация, загрузка весов, предобработка изображений, получение предсказаний.
- **src/app/database_mongo.py** — функции для получения изображений из MongoDB по ObjectId.
- **src/app/schemas.py** — Pydantic-схемы для валидации и сериализации данных API.
- **src/resources/class_names.txt** — список классов (названий блюд), которые может предсказывать модель.
- **src/requirements.txt** — основные зависимости Python.
- **src/requirements_tf_windows_cuda.txt** — зависимости для запуска на Windows с поддержкой CUDA.
- **src/requirements_tf_macos_arm.txt** — зависимости для MacOS ARM (Apple Silicon).
- **src/Dockerfile** — инструкция для сборки Docker-образа сервиса.

## Пример работы API

- **GET /nn/predict/{id}** — получить предсказание класса блюда по ID изображения из MongoDB.
- **GET /nn/classes** — получить список всех классов, которые может предсказывать модель.
- **GET /nn/classes/count** — получить количество классов.

## Используемые технологии

- **Python 3.9**
- **FastAPI** — быстрый и современный web-фреймворк для создания API.
- **TensorFlow** — библиотека для работы с нейросетями.
- **Keras** — высокоуровневый API для TensorFlow.
- **MongoDB** — база данных для хранения изображений.
- **Docker** — контейнеризация приложения.
- **Pydantic** — валидация данных.

## Как развернуть

1. **Локальный запуск (без Docker):**
   - Установить зависимости:
     ```bash
     pip install -r requirements.txt
     pip install -r requirements_tf_windows_cuda.txt  # или requirements_tf_macos_arm.txt для Mac
     ```
   - Запустить сервис:
     ```bash
     uvicorn main:app --reload
     ```

## Конфигурация

- Параметры модели (размеры изображений, количество классов, пути к весам и классам) задаются в классе `Config` внутри `neural_network.py`.
- Для корректной работы требуется файл весов модели (`resources/v1.weights.h5`) и файл с названиями классов (`resources/class_names.txt`).

## Пример использования

1. Загрузить изображение в MongoDB (этот функционал реализуется вне данного сервиса).
2. Получить ObjectId изображения.
3. Вызвать эндпоинт `/nn/predict/{id}` для получения предсказания.

## Примечания

- Веса модели и файл с классами должны быть заранее подготовлены и размещены в папке `resources`.
- В продакшене рекомендуется ограничить список разрешённых доменов для CORS.
- Для ускорения работы с GPU рекомендуется использовать соответствующие requirements-файлы.
        